---
- name: Load vault variables
  include_vars: vault.yml

- name: Ensure Podman is installed
  apt:
    name: podman
    state: present

- name: Create auto-update override directory
  file:
    path: /etc/systemd/system/podman-auto-update.timer.d
    state: directory
    mode: '0755'

- name: Configure auto-update schedule
  copy:
    dest: /etc/systemd/system/podman-auto-update.timer.d/override.conf
    content: |
      [Timer]
      OnCalendar=daily
      Persistent=true
  notify: Reload systemd

- name: Enable auto-update timer
  systemd:
    name: podman-auto-update.timer
    enabled: true
    state: started

- name: Deploy Quadlet container file
  template:
    src: translations.container.j2
    dest: /etc/containers/systemd/translations-helper.container
    mode: '0644'
  notify: Reload systemd

- name: Flush handlers to ensure systemd is reloaded before starting service
  meta: flush_handlers

- name: Enable and start translations-helper service
  systemd:
    name: translations-helper.service
    enabled: true
    state: started
