# Managed by Ansible - do not edit manually
# Tailscale IP so we can connect to this from raspberry
{
    admin 100.95.105.15:2019
    servers
    metrics
}

{% for site in caddy_sites %}
{{ site.domain }} {
    {% set ups = site.backends if (site.backends is defined and (site.backends | length) > 0) else [site.backend] %}
    reverse_proxy {{ ups | join(' ') }} {
        header_up X-Real-IP {remote_host}

        {% if site.lb_policy is defined and site.lb_policy %}
        lb_policy {{ site.lb_policy }}
        {% endif %}

        {% if site.health_uri is defined and site.health_uri %}
        health_uri {{ site.health_uri }}
        {% if site.health_interval is defined and site.health_interval %}health_interval {{ site.health_interval }}{% endif %}
        {% if site.health_timeout is defined and site.health_timeout %}health_timeout {{ site.health_timeout }}{% endif %}
        {% endif %}
    }
}

{% endfor %}